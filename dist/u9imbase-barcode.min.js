/*! 
 * 
 * Copyright 2017 u9mobile. 
 * 
 * u9imbase-barcode, v1.0.0 
 * 智能工厂移动应用-Base_Barcode库 
 * 
 * By @lwd 
 * 
 * Licensed under the MIT license. Please see LICENSE for more information. 
 * 
 */

!function(e,t){function r(){}function o(e){e.type="POST",n(e)}function n(t){var r={type:"GET",dataType:"JSON",cache:!0,urlPata:{},formPata:{},error:function(e){},success:function(e){}};if(void 0===t.dataType&&(t.dataType=r.dataType),void 0===t.type?t.type="GET":(t.dataType,t.type="POST"),void 0===t.cache&&(t.cache=r.cache),void 0!==t.urlPata){var o="",n=t.urlPata;for(var a in n)o+="&"+a+"="+n[a];t.url.indexOf("?")>=0?t.url+=o:t.url+=o.replace("&","?")}e.request({method:t.type,responseType:t.dataType,url:t.url,data:t.data,timeout:18e5}).then(function(e){t.success(e.data.Data)}).catch(function(e){"function"==typeof t.errorFn&&t.errorFn(e)})}function a(){var e={},r=JSON.parse(window.localStorage.getItem("U9ImPDA_org")),o="";r&&(o=r.Code),!o&&t.User("Orgs")&&(o=t.User("Orgs")[0].Code,r||window.localStorage.setItem("U9ImPDA_org",JSON.stringify(t.User("Orgs")[0]))),o&&(e.orgCode=o);var n=t.User("Orgs")[0].ErpEntCode;n&&(e.entCode=n);var a=t.User("Orgs")[0].ErpUserCode;return a?e.userCode=a:"智能工厂未定义用户的ERP用户编码，PDA读取ERP用户编码失败！",e.sysMLFlag="zh-CN",e}function i(e){var r=t.Connect("address"),o=t.Connect("port");return r&&o?"http://"+r+":"+o+e:null}function s(e){for(var t="",r=0;r<e;r++)t+="0";return t}r.prototype.getOrgCode=function(){var e=JSON.Parse(window.localStorage.getItem("U9ImPDA_org")),r="";return e&&(r=e.Code),!r&&t.User("Orgs")&&(r=t.User("Orgs")[0].Code,e||window.localStorage.setItem("U9ImPDA_org",JSON.stringify(t.User("Orgs")[0]))),r},r.prototype.barCodeAnalyze=function(e,t,r){this.context=a();var n={};n.url=i("/api/barcodeinfo/getBarCodeInfo"),n.data={Parameter:{BarCode:e.BarCode,OpType:e.OpType,DocTypeEnum:e.DocTypeEnum,EntCode:this.context.entCode,OrgCode:this.context.orgCode,UserCode:this.context.userCode,CultureName:this.context.sysMLFlag,OperationKey:e.OperationKey}},n.success=function(e){t&&t(e)},n.errorFn=function(e){r&&r(e)},o(n)},r.prototype.barCodeAnalyzeOnlyItemBC=function(e,t,r){this.context=a();var n={};n.url=i("/api/barcodeinfo/getBarCodeInfo"),n.data={Parameter:{BarCode:e,OpType:"BC_P_BarCodeAnalyze_Item_PDA",DocTypeEnum:-1,EntCode:this.context.entCode,OrgCode:this.context.orgCode,UserCode:this.context.userCode,CultureName:this.context.sysMLFlag,OperationKey:"QuickTransIn_BarCodeAnalyze"}},n.success=function(e){t&&t(e)},n.errorFn=function(e){r&&r(e)},o(n)},r.prototype.createDoc=function(e,r,n){this.context=a();var s=new Date,c={};c.url=i("/api/barcodeinfo/CreateRcvRecord"),c.data={Parameter:{OpType:e.OpType,DocType:e.DocTypeEnum,CultureName:this.context.sysMLFlag,EntCode:this.context.entCode,OrgCode:this.context.orgCode,UserCode:this.context.userCode,RcvUser:t.User("_id"),CreatedBy:this.context.userCode,RcvDateTime:s,CreateDocJSON:e.CreateDocJSON,DocDetialList:e.DocDetailList,OperationKey:e.OperationKey,IfWhTrans:e.IfWhTrans,AppKey:e.AppKey,DocCode:e.DocCode,OperType:e.OperType,SourceDocNum:e.SourceDocNum,BizOrgName:e.BizOrgName,Direction:e.Direction}},c.success=function(e){r&&r(e)},c.errorFn=function(e){n&&n(e)},o(c)},r.prototype.getWarehouseList=function(e,t,r){var n={};n.url=i("/api/barcodeInfo/getWarehouseList"),n.data={Parameter:{orgCode:e}},n.success=function(e){t&&t(e)},n.errorFn=function(e){r&&r(e)},o(n)},r.prototype.getBinList=function(e,t,r,n){var a={};a.url=i("/api/barcodeInfo/getBinList"),a.data={Parameter:{orgCode:e,wh:t}},a.success=function(e){r&&r(e)},a.errorFn=function(e){n&&n(e)},o(a)},r.prototype.fnRoundValue=function(e,t,r,o){if(!e)return"0";var n="";if(-1===String(e).indexOf("."))return 0===t?e:n=e+"."+s(t);if(e.substring(e.indexOf(".")+1).length<Number(t)){for(var a=Number(t)-e.substring(e.indexOf(".")+1).length,i="0",c=1;c<a;c++)i+="0";return e+=i}var u=e.indexOf(".")+Number(t),d=e.substring(0,Number(u)+1),p=e.substring(Number(u)+1,Number(u)+2),g=e.substring(Number(u)+1,e.length);if(0===Number(r)){var f="1"+Number(g),l="1"+s(e.length-1-u);if(accSub(f,l)>0){var C="";C=0===Number(t)?"1":"0."+s(t-1)+"1",n=accAdd(d,C)}else n=0===t?e.substring(0,u):e.substring(0,u+1)}else if(1===Number(r))n=e.substring(0,u+1);else if(2===Number(r))if(Number(p)<o)n=e.substring(0,u+1);else{var y="0";y=0===Number(t)?"1":"0."+s(t-1)+"1",n=Number(e)>0?accAdd(d,y):accSub(d,y)}return n},r.prototype.accAdd=function(e,t){var r,o=0,n=0,a=String(e).split(".");a&&a.length>0&&a[1]&&(o=a[1].length);var i=String(t).split(".");return i&&i.length>0&&i[1]&&(n=i[1].length),r=Math.pow(10,Math.max(o,n)),(e*r+t*r)/r},r.prototype.accSub=function(e,t){var r,o,n=0,a=0,i=String(e).split(".");i&&i.length>0&&i[1]&&(n=i[1].length);var s=String(t).split(".");return s&&s.length>0&&s[1]&&(a=s[1].length),r=Math.pow(10,Math.max(n,a)),o=n>=a?n:a,((e*r-t*r)/r).toFixed(o)},window.BarCodeServices=new r}(axios,window.u9);